rust_test_suite(
    name = "{{ crate_name_sanitized }}_integration_tests",
    srcs = [
        {%- for target in crate.test_targets %}
            "tests/{{target.name}}.rs",
        {%- endfor %}
    ],
    crate = ":{{ target_name_sanitized }}",
    data = []
    {%- if crate.raze_settings.data_attr %} + {{crate.raze_settings.data_attr}}
    {%- endif -%}
    {%- if crate.raze_settings.test_data_attr %} + {{crate.raze_settings.test_data_attr}}
    {%- endif -%},
    {%- if crate.raze_settings.data_dependencies %} + [
    {%- for dependency in crate.raze_settings.data_dependencies %}
        "{{dependency}}",
    {%- endfor %}
    ],
    {%- endif %}
    {%- if crate.raze_settings.compile_data_attr %}
    compile_data = {{crate.raze_settings.compile_data_attr}},
    {%- endif %}
    {%- include "templates/partials/features.template" -%},
    proc_macro_deps = [
    {%- for dependency in crate.default_deps.dependencies %}
    {%- if dependency.is_proc_macro %}
        "{{dependency.buildable_target}}",
    {%- endif %}
    {%- endfor %}
    ] + [
    {%- for dependency in crate.default_deps.dev_dependencies %}
    {%- if dependency.is_proc_macro %}
        "{{dependency.buildable_target}}",
    {%- endif %}
    {%- endfor %}
    ],
    {%- set deps = [crate_name_sanitized] %}
{%- for dependency in crate.default_deps.dependencies %}
{%- if not dependency.is_proc_macro %}
    {%- set_global deps = deps | concat(with=dependency.buildable_target) %}
{%- endif %}
{%- endfor %}
{%- for dependency in crate.default_deps.dev_dependencies %}
{%- if not dependency.is_proc_macro %}
    {%- set_global deps = deps | concat(with=dependency.buildable_target) %}
{%- endif %}
{%- endfor %}
{%- for dependency in crate.raze_settings.additional_deps %}
    {%- set_global deps = deps | concat(with=dependency) %}
{%- endfor %}
    deps = [
        {%- for dep in deps | sort %}
        "{{ dep }}",
        {%- endfor %}
    ]
    {%- if crate.targeted_deps %} 
    {%- include "templates/partials/targeted_dev_dependencies.template" -%},
    {%- else -%},
    {%- endif %}
)
